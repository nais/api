package vulnerability

import (
	"context"

	"github.com/nais/api/internal/v1/graphv1/pagination"
)

func GetImageMetadata(ctx context.Context, imageRef string) (*ImageDetails, error) {
	return fromContext(ctx).imageLoader.Load(ctx, imageRef)
}

func ListWorkloadReferences(ctx context.Context, image string, page *pagination.Pagination) (*pagination.Connection[*ContainerImageWorkloadReference], error) {
	metadata, err := fromContext(ctx).imageLoader.Load(ctx, image)
	if err != nil {
		return nil, err
	}

	all := metadata.WorkloadReferences
	slice := pagination.Slice(all, page)
	return pagination.NewConvertConnection(slice, page, int32(len(all)), toGraphWorkloadReference), nil
}
